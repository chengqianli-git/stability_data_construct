CREATE TABLE duplicate_key_optimized (
    -- === 排序键列 (5列) ===
    event_date DATE,
    tenant_id INT,
    event_type VARCHAR(20),
    region_code CHAR(3),
    status_code TINYINT,

    -- === 数值类型 (95列) ===
    user_id BIGINT,
    product_id BIGINT,
    session_id BIGINT,
    device_id BIGINT,
    page_id BIGINT,
    campaign_id BIGINT,
    content_id BIGINT,
    tinyint_metric1 TINYINT,
    tinyint_metric2 TINYINT,
    smallint_metric1 SMALLINT,
    smallint_metric2 SMALLINT,
    int_metric1 INT,
    int_metric2 INT,
    bigint_metric1 BIGINT,
    bigint_metric2 BIGINT,
    largeint_metric LARGEINT,
    decimal_metric1 DECIMAL(10,4),
    decimal_metric2 DECIMAL(15,6),
    decimal_metric3 DECIMAL(20,8),
    decimal_metric4 DECIMAL(8,2),
    decimal_metric5 DECIMAL(12,0),
    float_metric1 FLOAT,
    float_metric2 FLOAT,
    double_metric1 DOUBLE,
    double_metric2 DOUBLE,
    is_converted BOOLEAN,
    is_engaged BOOLEAN,
    is_bounced BOOLEAN,
    is_returning BOOLEAN,
    session_duration_seconds INT,
    page_duration_seconds INT,
    time_on_site_seconds INT,
    response_time_ms INT,
    load_time_ms INT,
    processing_time_ms INT,
    latency_ms INT,
    view_count INT,
    click_count INT,
    impression_count INT,
    conversion_count INT,
    scroll_depth_percent DECIMAL(5,2),
    click_through_rate DECIMAL(5,4),
    conversion_rate DECIMAL(5,4),
    bounce_rate DECIMAL(5,4),
    exit_rate DECIMAL(5,4),
    engagement_rate DECIMAL(5,4),
    retention_rate DECIMAL(5,4),
    churn_rate DECIMAL(5,4),
    revenue_amount DECIMAL(15,2),
    cost_amount DECIMAL(15,2),
    profit_amount DECIMAL(15,2),
    margin_amount DECIMAL(12,2),
    tax_amount DECIMAL(12,2),
    discount_amount DECIMAL(10,2),
    shipping_amount DECIMAL(10,2),
    ad_spend DECIMAL(12,2),
    cpc_cost DECIMAL(10,4),
    cpm_cost DECIMAL(10,4),
    cpa_cost DECIMAL(10,2),
    roi_ratio DECIMAL(8,4),
    roas_ratio DECIMAL(8,4),
    stock_quantity INT,
    reserved_quantity INT,
    available_quantity INT,
    reorder_level SMALLINT,
    safety_stock SMALLINT,
    min_stock_level SMALLINT,
    max_stock_level INT,
    login_count INT,
    purchase_count INT,
    cart_add_count INT,
    wishlist_count INT,
    review_count INT,
    rating_avg DECIMAL(3,2),
    rating_count INT,
    share_count INT,
    like_count INT,
    comment_count INT,
    follow_count INT,
    cpu_usage_percent DECIMAL(5,2),
    memory_usage_mb INT,
    disk_usage_gb DECIMAL(8,2),
    network_bytes_sent BIGINT,
    network_bytes_received BIGINT,
    request_count INT,
    error_count INT,
    success_count INT,
    failure_count INT,
    timeout_count INT,
    cache_hit_rate DECIMAL(5,3),
    data_quality_score DECIMAL(5,3),
    accuracy_score DECIMAL(5,3),
    completeness_score DECIMAL(5,3),
    consistency_score DECIMAL(5,3),
    timeliness_score DECIMAL(5,3),

    -- === 字符串类型 (65列) ===
    user_name VARCHAR(100),
    user_email VARCHAR(255),
    user_phone VARCHAR(30),
    user_address VARCHAR(500),
    product_name VARCHAR(300),
    product_description VARCHAR(2000),
    product_brand VARCHAR(100),
    product_manufacturer VARCHAR(150),
    product_category VARCHAR(50),
    product_type VARCHAR(30),
    order_type VARCHAR(20),
    payment_type VARCHAR(25),
    shipping_method VARCHAR(30),
    country_name VARCHAR(50),
    state_name VARCHAR(50),
    city_name VARCHAR(50),
    postal_code VARCHAR(20),
    timezone_name VARCHAR(50),
    ip_address VARCHAR(45),
    user_agent VARCHAR(1000),
    referrer_domain VARCHAR(100),
    landing_page_url VARCHAR(500),
    exit_page_url VARCHAR(500),
    current_page_url VARCHAR(500),
    previous_page_url VARCHAR(500),
    next_page_url VARCHAR(500),
    campaign_name VARCHAR(200),
    ad_group_name VARCHAR(150),
    keyword_text VARCHAR(100),
    creative_name VARCHAR(100),
    audience_segment VARCHAR(50),
    user_tier VARCHAR(15),
    membership_level VARCHAR(20),
    subscription_type VARCHAR(25),
    billing_cycle VARCHAR(20),
    device_type VARCHAR(50),
    device_model VARCHAR(80),
    os_name VARCHAR(50),
    os_version VARCHAR(20),
    browser_name VARCHAR(50),
    browser_version VARCHAR(20),
    screen_resolution VARCHAR(15),
    connection_type VARCHAR(20),
    carrier_name VARCHAR(50),
    app_name VARCHAR(100),
    app_version VARCHAR(20),
    sdk_version VARCHAR(20),
    api_version VARCHAR(10),
    protocol_version VARCHAR(10),
    status_message VARCHAR(500),
    error_description VARCHAR(1000),
    warning_message VARCHAR(500),
    info_message VARCHAR(500),
    debug_message VARCHAR(1000),
    transaction_id VARCHAR(100),
    batch_id VARCHAR(50),
    request_id VARCHAR(80),
    correlation_id VARCHAR(80),
    trace_id VARCHAR(80),
    span_id VARCHAR(80),
    download_url VARCHAR(500),
    image_url VARCHAR(500),
    video_url VARCHAR(500),
    document_url VARCHAR(500),
    thumbnail_url VARCHAR(500),

    -- === 日期时间类型 (20列) ===
    event_timestamp DATETIME,
    session_start_time DATETIME,
    session_end_time DATETIME,
    page_view_time DATETIME,
    click_time DATETIME,
    conversion_time DATETIME,
    purchase_time DATETIME,
    registration_date DATE,
    last_login_date DATE,
    first_purchase_date DATE,
    last_purchase_date DATE,
    campaign_start_date DATE,
    campaign_end_date DATE,
    promotion_start_date DATE,
    promotion_end_date DATE,
    subscription_start_date DATE,
    subscription_end_date DATE,
    created_date DATE,
    modified_date DATE,
    processed_date DATE,

    -- === 半结构化类型 (15列) ===
    event_data JSON,
    user_attributes JSON,
    product_attributes JSON,
    order_details JSON,
    payment_info JSON,
    shipping_info JSON,
    user_tags ARRAY<VARCHAR(50)>,
    product_tags ARRAY<VARCHAR(50)>,
    viewed_products ARRAY<VARCHAR(100)>,
    searched_keywords ARRAY<VARCHAR(100)>,
    user_preferences MAP<VARCHAR(50), VARCHAR(200)>,
    product_features MAP<VARCHAR(40), VARCHAR(150)>,
    session_attributes MAP<VARCHAR(30), VARCHAR(100)>,
    geo_location STRUCT<country VARCHAR(50), region VARCHAR(50), city VARCHAR(50), latitude DOUBLE, longitude DOUBLE>,
    device_info STRUCT<type VARCHAR(20), brand VARCHAR(30), model VARCHAR(50), os VARCHAR(20), browser VARCHAR(30)>

) DUPLICATE KEY (
    event_date, tenant_id, event_type, region_code, status_code
)
DISTRIBUTED BY HASH(event_date, tenant_id) BUCKETS 16
PROPERTIES (
    "replication_num" = "3",
    "storage_format" = "v2"
);